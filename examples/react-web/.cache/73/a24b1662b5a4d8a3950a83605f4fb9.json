{"id":"../../../src/core/initialize.ts","dependencies":[{"name":"/Users/jordanbell/Downloads/boardgame.io-15388af982023340eee1a28446d9632f2a2c2198/tsconfig.json","includedInParent":true,"mtime":1584497640000},{"name":"/Users/jordanbell/Downloads/boardgame.io-15388af982023340eee1a28446d9632f2a2c2198/examples/react-web/package.json","includedInParent":true,"mtime":1607025531871},{"name":"flatted","loc":{"line":1,"column":33},"parent":"/Users/jordanbell/Downloads/boardgame.io-15388af982023340eee1a28446d9632f2a2c2198/src/core/initialize.ts","resolved":"/Users/jordanbell/Downloads/boardgame.io-15388af982023340eee1a28446d9632f2a2c2198/node_modules/flatted/esm/index.js"},{"name":"./game","loc":{"line":2,"column":21},"parent":"/Users/jordanbell/Downloads/boardgame.io-15388af982023340eee1a28446d9632f2a2c2198/src/core/initialize.ts","resolved":"/Users/jordanbell/Downloads/boardgame.io-15388af982023340eee1a28446d9632f2a2c2198/src/core/game.ts"},{"name":"../plugins/main","loc":{"line":3,"column":25},"parent":"/Users/jordanbell/Downloads/boardgame.io-15388af982023340eee1a28446d9632f2a2c2198/src/core/initialize.ts","resolved":"/Users/jordanbell/Downloads/boardgame.io-15388af982023340eee1a28446d9632f2a2c2198/src/plugins/main.ts"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.InitializeGame = InitializeGame;\n\nvar _flatted = require(\"flatted\");\n\nvar _game = require(\"./game\");\n\nvar plugins = _interopRequireWildcard(require(\"../plugins/main\"));\n\nfunction _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n/**\n * InitializeGame\n *\n * Creates the initial game state.\n *\n * @param {...object} game - Return value of Game().\n * @param {...object} numPlayers - The number of players.\n * @param {...object} multiplayer - Set to true if we are in a multiplayer client.\n */\nfunction InitializeGame({\n  game,\n  numPlayers,\n  setupData\n}) {\n  game = (0, _game.Game)(game);\n\n  if (!numPlayers) {\n    numPlayers = 2;\n  }\n\n  let ctx = game.flow.ctx(numPlayers);\n  let state = {\n    // User managed state.\n    G: {},\n    // Framework managed state.\n    ctx,\n    // Plugin related state.\n    plugins: {}\n  }; // Run plugins over initial state.\n\n  state = plugins.Setup(state, {\n    game\n  });\n  state = plugins.Enhance(state, {\n    game\n  });\n  const enhancedCtx = plugins.EnhanceCtx(state);\n  state.G = game.setup(enhancedCtx, setupData);\n  let initial = { ...state,\n    // List of {G, ctx} pairs that can be undone.\n    _undo: [],\n    // List of {G, ctx} pairs that can be redone.\n    _redo: [],\n    // A monotonically non-decreasing ID to ensure that\n    // state updates are only allowed from clients that\n    // are at the same version that the server.\n    _stateID: 0,\n    // A copy of the initial state so that\n    // the log can replay actions on top of it.\n    // TODO: This should really be stored in a different\n    // part of the DB and not inside the state object.\n    _initial: {}\n  };\n  initial = game.flow.init(initial);\n  initial = plugins.Flush(initial, {\n    game\n  });\n\n  function deepCopy(obj) {\n    return (0, _flatted.parse)((0, _flatted.stringify)(obj));\n  }\n\n  initial._initial = deepCopy(initial);\n  return initial;\n}"},"sourceMaps":{"js":{"mappings":[{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":8,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":10,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":12,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":7,"column":0},"generated":{"line":18,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":16,"column":6},"generated":{"line":27,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":16,"column":16},"generated":{"line":27,"column":9}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":16,"column":6},"generated":{"line":27,"column":23}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":16,"column":31},"generated":{"line":27,"column":24}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":17,"column":2},"generated":{"line":28,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":17,"column":2},"generated":{"line":28,"column":2}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":16,"column":31},"generated":{"line":28,"column":6}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":18,"column":2},"generated":{"line":29,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":18,"column":2},"generated":{"line":29,"column":2}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":16,"column":31},"generated":{"line":29,"column":12}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":19,"column":2},"generated":{"line":30,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":19,"column":2},"generated":{"line":30,"column":2}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":16,"column":31},"generated":{"line":31,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":16,"column":6},"generated":{"line":31,"column":1}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":24,"column":1},"generated":{"line":31,"column":3}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":25,"column":2},"generated":{"line":32,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":25,"column":2},"generated":{"line":32,"column":2}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":25,"column":6},"generated":{"line":32,"column":6}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":25,"column":9},"generated":{"line":32,"column":9}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":25,"column":14},"generated":{"line":32,"column":25}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":25,"column":9},"generated":{"line":32,"column":29}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":25,"column":2},"generated":{"line":32,"column":30}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":27,"column":2},"generated":{"line":34,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":27,"column":6},"generated":{"line":34,"column":6}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":27,"column":7},"generated":{"line":34,"column":7}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":27,"column":2},"generated":{"line":34,"column":17}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":27,"column":19},"generated":{"line":34,"column":19}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":28,"column":4},"generated":{"line":35,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":28,"column":4},"generated":{"line":35,"column":4}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":28,"column":14},"generated":{"line":35,"column":14}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":28,"column":17},"generated":{"line":35,"column":17}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":28,"column":4},"generated":{"line":35,"column":18}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":29,"column":3},"generated":{"line":36,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":31,"column":2},"generated":{"line":38,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":31,"column":6},"generated":{"line":38,"column":6}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":31,"column":9},"generated":{"line":38,"column":9}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":31,"column":17},"generated":{"line":38,"column":12}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":31,"column":21},"generated":{"line":38,"column":16}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":31,"column":22},"generated":{"line":38,"column":17}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":31,"column":17},"generated":{"line":38,"column":21}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":31,"column":27},"generated":{"line":38,"column":22}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":31,"column":17},"generated":{"line":38,"column":25}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":31,"column":31},"generated":{"line":38,"column":26}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":31,"column":17},"generated":{"line":38,"column":36}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":31,"column":2},"generated":{"line":38,"column":37}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":33,"column":2},"generated":{"line":39,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":33,"column":6},"generated":{"line":39,"column":6}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":33,"column":11},"generated":{"line":39,"column":11}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":33,"column":25},"generated":{"line":39,"column":14}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":34,"column":4},"generated":{"line":40,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":35,"column":4},"generated":{"line":41,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":35,"column":4},"generated":{"line":41,"column":4}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":35,"column":5},"generated":{"line":41,"column":5}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":35,"column":7},"generated":{"line":41,"column":7}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":33,"column":25},"generated":{"line":41,"column":9}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":36,"column":4},"generated":{"line":42,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":37,"column":4},"generated":{"line":43,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":37,"column":4},"generated":{"line":43,"column":4}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":33,"column":25},"generated":{"line":43,"column":7}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":38,"column":4},"generated":{"line":44,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":39,"column":4},"generated":{"line":45,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":39,"column":4},"generated":{"line":45,"column":4}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":39,"column":11},"generated":{"line":45,"column":11}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":39,"column":13},"generated":{"line":45,"column":13}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":33,"column":25},"generated":{"line":46,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":33,"column":2},"generated":{"line":46,"column":3}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":24,"column":1},"generated":{"line":46,"column":4}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":42,"column":2},"generated":{"line":46,"column":5}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":43,"column":2},"generated":{"line":48,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":43,"column":2},"generated":{"line":48,"column":2}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":43,"column":7},"generated":{"line":48,"column":7}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":43,"column":10},"generated":{"line":48,"column":10}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":43,"column":17},"generated":{"line":48,"column":17}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":43,"column":18},"generated":{"line":48,"column":18}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":43,"column":10},"generated":{"line":48,"column":23}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":43,"column":24},"generated":{"line":48,"column":24}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":43,"column":10},"generated":{"line":48,"column":29}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":43,"column":31},"generated":{"line":48,"column":31}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":43,"column":33},"generated":{"line":49,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":43,"column":33},"generated":{"line":49,"column":4}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":43,"column":31},"generated":{"line":50,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":43,"column":10},"generated":{"line":50,"column":3}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":43,"column":2},"generated":{"line":50,"column":4}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":44,"column":2},"generated":{"line":51,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":44,"column":2},"generated":{"line":51,"column":2}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":44,"column":7},"generated":{"line":51,"column":7}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":44,"column":10},"generated":{"line":51,"column":10}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":44,"column":17},"generated":{"line":51,"column":17}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":44,"column":18},"generated":{"line":51,"column":18}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":44,"column":10},"generated":{"line":51,"column":25}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":44,"column":26},"generated":{"line":51,"column":26}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":44,"column":10},"generated":{"line":51,"column":31}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":44,"column":42},"generated":{"line":51,"column":33}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":44,"column":44},"generated":{"line":52,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":44,"column":44},"generated":{"line":52,"column":4}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":44,"column":42},"generated":{"line":53,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":44,"column":10},"generated":{"line":53,"column":3}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":44,"column":2},"generated":{"line":53,"column":4}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":46,"column":2},"generated":{"line":54,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":46,"column":8},"generated":{"line":54,"column":8}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":46,"column":19},"generated":{"line":54,"column":19}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":46,"column":22},"generated":{"line":54,"column":22}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":46,"column":29},"generated":{"line":54,"column":29}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":46,"column":30},"generated":{"line":54,"column":30}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":46,"column":22},"generated":{"line":54,"column":40}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":46,"column":41},"generated":{"line":54,"column":41}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":46,"column":22},"generated":{"line":54,"column":46}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":46,"column":2},"generated":{"line":54,"column":47}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":47,"column":2},"generated":{"line":55,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":47,"column":2},"generated":{"line":55,"column":2}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":47,"column":7},"generated":{"line":55,"column":7}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":47,"column":8},"generated":{"line":55,"column":8}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":47,"column":2},"generated":{"line":55,"column":9}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":47,"column":12},"generated":{"line":55,"column":12}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":47,"column":16},"generated":{"line":55,"column":16}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":47,"column":17},"generated":{"line":55,"column":17}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":47,"column":12},"generated":{"line":55,"column":22}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":47,"column":23},"generated":{"line":55,"column":23}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":47,"column":12},"generated":{"line":55,"column":34}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":47,"column":36},"generated":{"line":55,"column":36}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":47,"column":12},"generated":{"line":55,"column":45}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":47,"column":2},"generated":{"line":55,"column":46}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":49,"column":2},"generated":{"line":56,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":49,"column":6},"generated":{"line":56,"column":6}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":49,"column":13},"generated":{"line":56,"column":13}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":49,"column":23},"generated":{"line":56,"column":16}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":50,"column":4},"generated":{"line":56,"column":18}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":50,"column":7},"generated":{"line":56,"column":21}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":49,"column":23},"generated":{"line":56,"column":26}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":52,"column":4},"generated":{"line":57,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":53,"column":4},"generated":{"line":58,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":53,"column":4},"generated":{"line":58,"column":4}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":53,"column":9},"generated":{"line":58,"column":9}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":53,"column":11},"generated":{"line":58,"column":11}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":49,"column":23},"generated":{"line":58,"column":13}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":54,"column":4},"generated":{"line":59,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":55,"column":4},"generated":{"line":60,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":55,"column":4},"generated":{"line":60,"column":4}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":55,"column":9},"generated":{"line":60,"column":9}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":55,"column":11},"generated":{"line":60,"column":11}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":49,"column":23},"generated":{"line":60,"column":13}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":56,"column":4},"generated":{"line":61,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":57,"column":4},"generated":{"line":62,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":58,"column":4},"generated":{"line":63,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":59,"column":4},"generated":{"line":64,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":59,"column":4},"generated":{"line":64,"column":4}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":59,"column":12},"generated":{"line":64,"column":12}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":59,"column":14},"generated":{"line":64,"column":14}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":49,"column":23},"generated":{"line":64,"column":15}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":60,"column":4},"generated":{"line":65,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":61,"column":4},"generated":{"line":66,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":62,"column":4},"generated":{"line":67,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":63,"column":4},"generated":{"line":68,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":64,"column":4},"generated":{"line":69,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":64,"column":4},"generated":{"line":69,"column":4}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":64,"column":12},"generated":{"line":69,"column":12}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":64,"column":14},"generated":{"line":69,"column":14}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":49,"column":23},"generated":{"line":70,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":49,"column":2},"generated":{"line":70,"column":3}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":67,"column":2},"generated":{"line":71,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":67,"column":2},"generated":{"line":71,"column":2}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":67,"column":9},"generated":{"line":71,"column":9}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":67,"column":12},"generated":{"line":71,"column":12}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":67,"column":16},"generated":{"line":71,"column":16}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":67,"column":17},"generated":{"line":71,"column":17}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":67,"column":12},"generated":{"line":71,"column":21}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":67,"column":22},"generated":{"line":71,"column":22}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":67,"column":12},"generated":{"line":71,"column":26}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":67,"column":27},"generated":{"line":71,"column":27}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":67,"column":12},"generated":{"line":71,"column":34}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":67,"column":2},"generated":{"line":71,"column":35}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":68,"column":2},"generated":{"line":72,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":68,"column":2},"generated":{"line":72,"column":2}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":68,"column":9},"generated":{"line":72,"column":9}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":68,"column":12},"generated":{"line":72,"column":12}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":68,"column":19},"generated":{"line":72,"column":19}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":68,"column":20},"generated":{"line":72,"column":20}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":68,"column":12},"generated":{"line":72,"column":25}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":68,"column":26},"generated":{"line":72,"column":26}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":68,"column":12},"generated":{"line":72,"column":33}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":68,"column":35},"generated":{"line":72,"column":35}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":68,"column":37},"generated":{"line":73,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":68,"column":37},"generated":{"line":73,"column":4}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":68,"column":35},"generated":{"line":74,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":68,"column":12},"generated":{"line":74,"column":3}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":68,"column":2},"generated":{"line":74,"column":4}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":70,"column":2},"generated":{"line":76,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":70,"column":11},"generated":{"line":76,"column":11}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":70,"column":2},"generated":{"line":76,"column":19}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":70,"column":23},"generated":{"line":76,"column":20}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":70,"column":2},"generated":{"line":76,"column":23}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":70,"column":29},"generated":{"line":76,"column":25}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":71,"column":4},"generated":{"line":77,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":71,"column":11},"generated":{"line":77,"column":11}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":71,"column":17},"generated":{"line":77,"column":31}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":71,"column":27},"generated":{"line":77,"column":55}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":71,"column":17},"generated":{"line":77,"column":58}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":71,"column":11},"generated":{"line":77,"column":59}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":71,"column":4},"generated":{"line":77,"column":60}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":72,"column":3},"generated":{"line":78,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":73,"column":2},"generated":{"line":80,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":73,"column":2},"generated":{"line":80,"column":2}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":73,"column":9},"generated":{"line":80,"column":9}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":73,"column":10},"generated":{"line":80,"column":10}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":73,"column":2},"generated":{"line":80,"column":18}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":73,"column":21},"generated":{"line":80,"column":21}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":73,"column":29},"generated":{"line":80,"column":29}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":73,"column":30},"generated":{"line":80,"column":30}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":73,"column":29},"generated":{"line":80,"column":37}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":73,"column":2},"generated":{"line":80,"column":38}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":75,"column":2},"generated":{"line":81,"column":0}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":75,"column":9},"generated":{"line":81,"column":9}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":75,"column":2},"generated":{"line":81,"column":16}},{"source":"../../../src/core/initialize.ts","name":null,"original":{"line":76,"column":1},"generated":{"line":82,"column":0}}],"sources":{"../../../src/core/initialize.ts":"import { parse, stringify } from 'flatted';\nimport { Game } from './game';\nimport { GameConfig } from '../types';\nimport * as plugins from '../plugins/main';\nimport { GameState, State, Ctx } from '../types';\n\n/**\n * InitializeGame\n *\n * Creates the initial game state.\n *\n * @param {...object} game - Return value of Game().\n * @param {...object} numPlayers - The number of players.\n * @param {...object} multiplayer - Set to true if we are in a multiplayer client.\n */\nexport function InitializeGame({\n  game,\n  numPlayers,\n  setupData,\n}: {\n  game: GameConfig;\n  numPlayers: number;\n  setupData?: any;\n}) {\n  game = Game(game);\n\n  if (!numPlayers) {\n    numPlayers = 2;\n  }\n\n  let ctx: Ctx = game.flow.ctx(numPlayers);\n\n  let state: GameState = {\n    // User managed state.\n    G: {},\n    // Framework managed state.\n    ctx,\n    // Plugin related state.\n    plugins: {},\n  };\n\n  // Run plugins over initial state.\n  state = plugins.Setup(state, { game });\n  state = plugins.Enhance(state as State, { game });\n\n  const enhancedCtx = plugins.EnhanceCtx(state);\n  state.G = game.setup(enhancedCtx, setupData);\n\n  let initial: State = {\n    ...state,\n\n    // List of {G, ctx} pairs that can be undone.\n    _undo: [],\n    // List of {G, ctx} pairs that can be redone.\n    _redo: [],\n    // A monotonically non-decreasing ID to ensure that\n    // state updates are only allowed from clients that\n    // are at the same version that the server.\n    _stateID: 0,\n    // A copy of the initial state so that\n    // the log can replay actions on top of it.\n    // TODO: This should really be stored in a different\n    // part of the DB and not inside the state object.\n    _initial: {},\n  };\n\n  initial = game.flow.init(initial);\n  initial = plugins.Flush(initial, { game });\n\n  function deepCopy<T>(obj: T): T {\n    return parse(stringify(obj));\n  }\n  initial._initial = deepCopy(initial);\n\n  return initial;\n}\n"},"lineCount":null}},"error":null,"hash":"01685ac71d05c7d4102a5ec33b45e413","cacheData":{"env":{}}}